- service: data
  command: true

- service: compile
  command: cp /go/src/github.com/replaygaming/go-eventsource/go-eventsource /artifacts
  dockercfg_service: gcr_dockercfg

- service: dist
  command: true

- name: deployment
  type: parallel
  steps:
  - service: deploy
    type: push
    image_name: us.gcr.io/replay-gaming/go-eventsource
    image_tag: "latest"
    registry: https://us.gcr.io
    dockercfg_service: gcr_dockercfg

  - service: deploy
    type: push
    image_name: us.gcr.io/replay-gaming/go-eventsource
    image_tag: "{{.Timestamp}}"
    registry: https://us.gcr.io
    dockercfg_service: gcr_dockercfg

  - service: deploy
    type: push
    image_name: us.gcr.io/replay-gaming/go-eventsource
    image_tag: "{{.CommitID}}"
    registry: https://us.gcr.io
    dockercfg_service: gcr_dockercfg
