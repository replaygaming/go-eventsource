gcr_dockercfg:
  image: codeship/gcr-dockercfg-generator
  add_docker: true
  encrypted_env_file: google_deployment.env.encrypted

compile:
  build:
    image: us.gcr.io/replay-gaming/go-eventsource-compile
    dockerfile_path: Dockerfile.build
  volumes:
    - ./tmp:/artifacts

dist:
  build:
    image: us.gcr.io/replay-gaming/go-eventsource
    dockerfile_path: Dockerfile.dist

emulator:
  image: us.gcr.io/replay-gaming/pubsub_emulator

eventsource:
  depends_on:
    - emulator
  build:
    image: eventsource_with_wait
    path: integration_test
    dockerfile_path: Dockerfile
  environment:
    PUBSUB_EMULATOR_HOST: emulator:8642
  links:
    - emulator

eventsource_integration_tests:
  depends_on:
    - emulator
    - eventsource
  build:
    image: eventsource_integration_tests
    dockerfile_path: integration_test/Dockerfile.test_runner
  environment:
    PUBSUB_EMULATOR_HOST: emulator:8642
  links:
    - emulator
    - eventsource
