<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
  <script>
    var source;
    var reconnecting = false;

    var msg = function( message ){
      document.body.innerHTML += '<p>' + message + '</p>';
    }

    if (!!window.EventSource) {
      source = new EventSource('http://0.0.0.0:4000/subscribe?channels=*');

      source.addEventListener('message', function(e) {
        msg( e.data );
      }, false);

      source.addEventListener('open', function(e) {
        msg( 'Connected' );
        reconnecting = false;
      }, false);

      source.addEventListener('error', function(e) {
        if (e.readyState == EventSource.CLOSED) {
          msg( 'Closed by server' );
        } else if(!reconnecting) {
          msg( 'Reconnecting...' );
          reconnecting = true;
        }
      }, false);
    } else {
      msg('No EventSource support in this browser :/');
    }
  </script>
</body>
</html>
